<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
<script type="text/javascript" src="./js/libs/pixi.js"></script>
</head>
<body style="margin: 0; padding: 0;">

<script type="text/javascript">


var renderer = new PIXI.autoDetectRenderer(innerWidth,innerHeight);

    document.body.appendChild(renderer.view);

    var stage = new PIXI.Stage;



    var elements = [


        {
            parent:stage,
            element: {
                        from:"fromImage",
                        content:"./img/table_wh_bg.png",
                        params:{
                            position:{x:80,y:70},
                            scale:{x:0.45,y:0.45}
                            //rotation : 1.6
                        }}

        },
        {
            parent:stage,
            element: {from:"fromImage", content:"./img/poker_chip.png",
                params:
                {
                    position:{x:10,y:10},
                    scale:{x:0.2,y:0.2},
                    interactive:true,
                    buttonMode: true
                }},
            eventListeners: createEventlistenersForChip

        }


    ]

    stage.setBackgroundColor("0xCCCCCC");
    elementsFactory(elements);

    requestAnimationFrame(animate);

    function animate() {
        //bunny.rotation += 0.01;

        renderer.render(stage);

        requestAnimationFrame(animate);
    }


    function createElement(from, content, params){
        var newTexture = PIXI.Texture[from](content);
        var sprite = new PIXI.Sprite(newTexture);

        /*sprite.position.x = params.position.x;
        sprite.position.y = params.position.y;

        sprite.scale.x = params.scale ? params.scale.x : 1;
        sprite.scale.y = params.scale ? params.scale.y : 1;*/

        for(key in params)
        {
            sprite[key] = params[key];
        }

        return sprite;
    }

    function elementsFactory(elements){
        /*
        [
            {
                parent: parent,
                element: {from, content, params},
                childrens: [{parent, element, childrens}],
                pixiSprite: willBeCreatedFromCreateElement,
                eventListeners
            }
        ]
         */
        for(var i=0;i<elements.length;i++)
        {
            var element = createElement(elements[i].element.from, elements[i].element.content, elements[i].element.params);
            elements[i].pixiSprite = element;
            if(elements[i].childrens && elements[i].childrens.length)
            {
                for(var j=0; j<elements[i].childrens.length;j++)
                {
                    elements[i].childrens[j].parent = element;
                }
                elementsFactory(elements[i].childrens)
            }
            if(elements[i].eventListeners)
                elements[i].eventListeners(element);
            elements[i].parent.addChild(element);

        }
    }


    function createEventlistenersForChip(chip){
        chip.mousedown = chip.touchstart = function(data)
        {
            //		data.originalEvent.preventDefault()
            // store a refference to the data
            // The reason for this is because of multitouch
            // we want to track the movement of this particular touch
            this.data = data;
            this.alpha = 0.9;
            this.dragging = true;
        };

        // set the events for when the mouse is released or a touch is released
        chip.mouseup = chip.mouseupoutside = chip.touchend = chip.touchendoutside = function(data)
        {
            this.alpha = 1
            this.dragging = false;
            // set the interaction data to null
            this.data = null;
        };

        // set the callbacks for when the mouse or a touch moves
        chip.mousemove = chip.touchmove = function(data)
        {
            if(this.dragging)
            {
                // need to get parent coords..
                var newPosition = this.data.getLocalPosition(this.parent);
                this.position.x = newPosition.x-50;
                this.position.y = newPosition.y-50;
            }
        }
    }



</script>

</body>
</html>