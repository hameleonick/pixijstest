<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <script type="text/javascript" src="./js/libs/pixi.js"></script>
</head>

<style>

    /*canvas*/
    /*{*/
        /*width: 100% !important;*/
        /*height: 100%  !important;*/
        /*top:0;*/
        /*left:0;*/
        /*position: absolute;*/
    /*}*/



</style>
<body style="margin: 0; padding: 0; width: 100%; height: 100%">


<script>

    var standartWidth = 640;
    var standartHeight = 960;

    /*
     *   x = 75
     *   y = 75
     *
     *
     *   detect max size of Width/Height
     *
     * */
    var deviceWidth = 0;
    var deviceHeight = 0;
    var scaleWidthFactor;
    var scaleHeightFactor;
    if(navigator.userAgent.indexOf("iPhone")+1){
        deviceWidth = screen.availWidth;
        deviceHeight = screen.availHeight;

        scaleWidthFactor = deviceWidth/standartWidth;
        scaleHeightFactor = deviceHeight/standartHeight;

    }
    else if(navigator.userAgent.indexOf("Android")+1)
    {
        deviceHeight = window.innerHeight;
        deviceWidth = window.innerWidth;

        scaleWidthFactor = (deviceWidth/standartWidth)//window.devicePixelRatio;
        scaleHeightFactor = (deviceHeight/standartHeight)//window.devicePixelRatio;
    }

    var scaleFactor = Math.max(scaleHeightFactor,scaleWidthFactor);

    var renderer = new PIXI.autoDetectRecommendedRenderer(640,960);//
    document.body.appendChild(renderer.view);
    renderer.resize(640,960)

    var stage = new PIXI.Stage();

    stage.setBackgroundColor(0x0000FF);

    var img_shadow = new Image();

    img_shadow.src = "./img/table_shadow.png";

    var tableShadowBaseTexture = new PIXI.BaseTexture(img_shadow);
    var tableShadowTexture =  new PIXI.Texture(tableShadowBaseTexture, new PIXI.Rectangle(0, 0, 640, 960));
    var tableShadowSprite = new PIXI.Sprite(tableShadowTexture);

    tableShadowSprite.anchor.x = 0.5
    tableShadowSprite.anchor.y = 0.5

    var img_table = new Image();

    img_table.src = "./img/table_top.png";

    var tableBaseTexture = new PIXI.BaseTexture(img_table);
    var tableTexture =  new PIXI.Texture(tableBaseTexture, new PIXI.Rectangle(0, 0, 640, 960));
    var tableSprite = new PIXI.Sprite(tableTexture);

    tableSprite.anchor.x = 0.5
    tableSprite.anchor.y = 0.5

    tableShadowSprite.addChild(tableSprite)


    var img_chip = new Image();

    img_chip.src = "./img/chip_blue_big_1.png";
    var chipBaseTexture = new PIXI.BaseTexture(img_chip);
    var chipTexture =  new PIXI.Texture(chipBaseTexture, new PIXI.Rectangle(0, 0, 100, 100));
    var chipSprite = new PIXI.Sprite(chipTexture);

    chipSprite.scale.x = 1.5;
    chipSprite.scale.y = 1.5;

    chipSprite.anchor.x = 0.5
    chipSprite.anchor.y = 0.5

    chipSprite.position.x = 240;
    chipSprite.position.y = 300;

    chipSprite.interactive = true;
    chipSprite.buttonMode = true;

    createEventlistenersForChip(chipSprite)

    var img_slider_back_left = new Image();
    img_slider_back_left.src = "./img/slider/sliderback_left.png";

    var sliderBackLeftBaseTexture = new PIXI.BaseTexture(img_slider_back_left);
    var sliderBackLeftTexture =  new PIXI.Texture(sliderBackLeftBaseTexture, new PIXI.Rectangle(0, 0, 100, 100));
    var sliderBackLeftSprite = new PIXI.Sprite(sliderBackLeftTexture);

    sliderBackLeftSprite.position.x = -240;
    sliderBackLeftSprite.position.y = 400;

    sliderBackLeftSprite.anchor.x = 0.5
    sliderBackLeftSprite.anchor.y = 0.5

    var displayObjCont = new PIXI.DisplayObjectContainer();
    displayObjCont.position.x = 1;
    displayObjCont.position.y = 1;
    displayObjCont.addChild(tableShadowSprite)

    displayObjCont.addChild(sliderBackLeftSprite)
    displayObjCont.addChild(chipSprite)
    stage.addChild(displayObjCont)

    resize()

    requestAnimationFrame(animate);


    function animate() {
        //bunny.rotation += 0.01;

        renderer.render(stage);

        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize, false);
    window.addEventListener('orientationchange', resize, false);

    function resize()
    {

        var standartWidth = 640;
        var standartHeight = 960;

        /*
         *   x = 75
         *   y = 75
         *
         *
         *   detect max size of Width/Height
         *
         * */
        var deviceWidth = 0;
        var deviceHeight = 0;
        var scaleWidthFactor;
        var scaleHeightFactor;
        if(navigator.userAgent.indexOf("iPhone")+1){
            deviceWidth = screen.availWidth;
            deviceHeight = screen.availHeight;

            scaleWidthFactor = deviceWidth/standartWidth;
            scaleHeightFactor = deviceHeight/standartHeight;

        }
        else if(navigator.userAgent.indexOf("Android")+1)
        {
            deviceHeight = window.innerHeight;
            deviceWidth = window.innerWidth;

            scaleWidthFactor = (deviceWidth/standartWidth)//window.devicePixelRatio;
            scaleHeightFactor = (deviceHeight/standartHeight)//window.devicePixelRatio;
        }

        var scaleDeltaMin = Math.min(scaleWidthFactor,scaleHeightFactor);
        var scaleDeltaMax = Math.max(scaleWidthFactor,scaleHeightFactor);
        renderer.resize(deviceWidth,deviceHeight)

        displayObjCont.scale.x = scaleDeltaMin
        displayObjCont.scale.y = scaleDeltaMin
        displayObjCont.position.x = deviceWidth/2;
        displayObjCont.position.y = deviceHeight/2;
    }


    function createEventlistenersForChip(chip){
        chip.mousedown = chip.touchstart = function(data)
        {
            //		data.originalEvent.preventDefault()
            // store a refference to the data
            // The reason for this is because of multitouch
            // we want to track the movement of this particular touch
            this.data = data;
            this.alpha = 0.9;
            this.dragging = true;
        };

        // set the events for when the mouse is released or a touch is released
        chip.mouseup = chip.mouseupoutside = chip.touchend = chip.touchendoutside = function(data)
        {
            this.alpha = 1
            this.dragging = false;
            // set the interaction data to null
            this.data = null;
        };

        // set the callbacks for when the mouse or a touch moves
        chip.mousemove = chip.touchmove = function(data)
        {

            if(this.dragging)
            {
                console.log(this);
                // need to get parent coords..
                var newPosition = this.data.getLocalPosition(this.parent);
                this.position.x = newPosition.x//-50;
                this.position.y = newPosition.y//-50;
            }
        }
    }

</script>

</body>
</html>